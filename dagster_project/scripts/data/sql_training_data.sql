SELECT
	SNDT.LAPTIME_FP1,
    SNDT.COMPOUND_FP1,
    SNDT.AIR_TEMP_FP1,
    SNDT.RAINFALL_FP1,
    SNDT.TRACK_TEMP_FP1,
    IFNULL(SNDT.LAPTIME_FP2, 0) AS LAPTIME_FP2,
    IFNULL(SNDT.COMPOUND_FP2, 0) AS COMPOUND_FP2,
    IFNULL(SNDT.AIR_TEMP_FP2, 0) AS AIR_TEMP_FP2,
    IFNULL(SNDT.RAINFALL_FP2, 0) AS RAINFALL_FP2,
    IFNULL(SNDT.TRACK_TEMP_FP2, 0) AS TRACK_TEMP_FP2,
    IFNULL(SNDT.LAPTIME_FP3, 0) AS LAPTIME_FP3,
    IFNULL(SNDT.COMPOUND_FP3, 0) AS COMPOUND_FP3,
    IFNULL(SNDT.AIR_TEMP_FP3, 0) AS AIR_TEMP_FP3,
    IFNULL(SNDT.RAINFALL_FP3, 0) AS RAINFALL_FP3,
    IFNULL(SNDT.TRACK_TEMP_FP3, 0) AS TRACK_TEMP_FP3,
    SNDT.LAPTIME_Q,
    SNDT.AIR_TEMP_Q,
    SNDT.RAINFALL_Q,
    1 AS IS_SPRINT,
    TRK.TRACTION,
    TRK.TYRE_STRESS,
    TRK.ASPHALT_GRIP,
    TRK.BRAKING,
    TRK.ASPHALT_ABRASION,
    TRK.LATERAL_FORCE,
    TRK.TRACK_EVOLUTION,
    TRK.DOWNFORCE
FROM CLEANED_SESSION_DATA SNDT
LEFT JOIN DIM_EVENT EVT
	ON SNDT.EVENT_CD = EVT.EVENT_CD
LEFT JOIN DIM_TRACK TRK
	ON EVT.TRACK_CD = TRK.TRACK_CD
WHERE
	EVENT_TYPE_CD = 2
	AND LAPTIME_Q IS NOT NULL
	AND EVT.EVENT_CD != '{event_cd}'

UNION ALL

SELECT
	SNDT.LAPTIME_FP1,
    SNDT.COMPOUND_FP1,
    SNDT.AIR_TEMP_FP1,
    SNDT.RAINFALL_FP1,
    SNDT.TRACK_TEMP_FP1,
    SNDT.LAPTIME_FP2,
    SNDT.COMPOUND_FP2,
    SNDT.AIR_TEMP_FP2,
    SNDT.RAINFALL_FP2,
    SNDT.TRACK_TEMP_FP2,
    SNDT.LAPTIME_FP3,
    SNDT.COMPOUND_FP3,
    SNDT.AIR_TEMP_FP3,
    SNDT.RAINFALL_FP3,
    SNDT.TRACK_TEMP_FP3,
    SNDT.LAPTIME_Q,
    SNDT.AIR_TEMP_Q,
    SNDT.RAINFALL_Q,
    0 AS IS_SPRINT,
    TRK.TRACTION,
    TRK.TYRE_STRESS,
    TRK.ASPHALT_GRIP,
    TRK.BRAKING,
    TRK.ASPHALT_ABRASION,
    TRK.LATERAL_FORCE,
    TRK.TRACK_EVOLUTION,
    TRK.DOWNFORCE
FROM CLEANED_SESSION_DATA SNDT
LEFT JOIN DIM_EVENT EVT
	ON SNDT.EVENT_CD = EVT.EVENT_CD
LEFT JOIN DIM_TRACK TRK
	ON EVT.TRACK_CD = TRK.TRACK_CD
WHERE
	EVENT_TYPE_CD = 1
	AND LAPTIME_Q IS NOT NULL
	AND EVT.EVENT_CD != '{event_cd}'